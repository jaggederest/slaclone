<!DOCTYPE html>
<html>
<head>
</head>
<body>
<h1>Sla<em>clone</em></h1>
<section id="channels">
  <input type="text" id="create_channel_field"><button onClick="channel_create($('#create_channel_field').val())">create channel</button>
</section>
<section id="chatarea">
  <input type="text" id="chatfield"><button onClick="send_message($('#chatfield').val(), $('#channel_selector').val())">send</button>
</section>

<script src="https://rawgit.com/bnorton/hookly.js/master/hookly.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>
function channel_callback(name) {
  return function callback(data) {
    document.getElementById('channel'+name).innerHTML += data.name
  }
}

function channel_create(name) {
  // the dom element *is* the channel
  if(!($('#channel' + name).length)) {
    hookly.on(name, channel_callback(name))
    $('#channels').append(channel_dom(name));
    send_message(name, '#channels');
  }
}

function channel_dom(name) {
  return '<div id="channel' + name + '"><h2>' + name + '</h2></div>'
}

msg_id = 1;
function send_message(message, channel) {
  // could do some fancy optional parameter here for the channel later
  hookly.notify(channel, {id: msg_id++, name: message } );
}

hookly.start("T8xqNNb1yRpUhSJvNEizsBVpDrfT-UyEYD3ENafogfmznG")
channel_create('#updates')
hookly.on('#channels', function(data) { create_channel(data.name) })
</script>
</body>
</html>